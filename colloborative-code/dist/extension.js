(()=>{"use strict";var e={86:e=>{e.exports=require("ws")},265:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),a=0;a<n.length;a++)"default"!==n[a]&&o(t,e,n[a]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){const t=c.commands.registerCommand("colloborative.startSession",async()=>{d=await c.window.showInputBox({placeHolder:"Enter room code",prompt:"Users with the same code join the same room"})||"";const e=await c.window.showQuickPick(["Host","Client"],{placeHolder:"Select your role"});p="Host"===e,u=new s("ws://localhost:3000"),u.on("open",()=>{c.window.showInformationMessage(`Connected to room ${d}`),u?.send(JSON.stringify({type:"join",room:d,role:p?"host":"client"}))}),u.on("message",async e=>{try{const t=JSON.parse(e.toString());if(t.room!==d)return;if(t.clientId===f)return;switch(t.type){case"activeFile":if(g=t.filePath,!p){const e=await c.workspace.openTextDocument({content:t.content});await c.window.showTextDocument(e,{preview:!1})}break;case"edit":!async function(e){const t=g,n=c.workspace.textDocuments.find(e=>e.uri.toString()===t);if(!n)return;if(h.has(t))return;h.add(t);const r=new c.WorkspaceEdit;r.replace(n.uri,new c.Range(new c.Position(e.range.start.line,e.range.start.character),new c.Position(e.range.end.line,e.range.end.character)),e.text),await c.workspace.applyEdit(r),h.delete(t)}(t)}}catch(e){console.error("Failed to handle incoming message:",e)}}),u.on("close",()=>{c.window.showWarningMessage("Disconnected from collaboration server")}),p&&c.window.onDidChangeActiveTextEditor(e=>{e&&u&&u.readyState===s.OPEN&&(g=e.document.uri.toString(),u.send(JSON.stringify({type:"activeFile",room:d,filePath:g,content:e.document.getText()})))}),c.workspace.onDidChangeTextDocument(e=>{if(!w&&u&&u.readyState===s.OPEN&&0!==e.contentChanges.length)for(const t of e.contentChanges)u.send(JSON.stringify({type:"edit",room:d,clientId:f,filePath:g??e.document.uri.toString(),range:{start:{line:t.range.start.line,character:t.range.start.character},end:{line:t.range.end.line,character:t.range.end.character}},text:t.text}))})});e.subscriptions.push(t)},t.deactivate=function(){u&&u.close()};const c=a(n(398)),s=n(86),l=n(982);let u=null,d="",f=(0,l.randomUUID)(),p=!1,w=!1,g=null;const h=new Set},398:e=>{e.exports=require("vscode")},982:e=>{e.exports=require("crypto")}},t={},n=function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}(265);module.exports=n})();